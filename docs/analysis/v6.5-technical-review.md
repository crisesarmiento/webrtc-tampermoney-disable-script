
## Current Strengths

- No redundant `setParameters()` calls → lower risk of glitches/reconfigs
- Soft clipper no longer eats 40% of headroom
- Gain adjustable live without reload
- DTX disabled (`usedtx=0`) → music tails / quiet parts not cut
- `contentHint = 'music'` set aggressively (on track, sender, timeout)
- 128 kbps VBR target + fullband Opus params preserved in SDP
- Dynamics gentler → music sounds less squashed, voice still cuts through
- No manual command needed for normal music+voice use

## Known Limitations / Trade-offs

1. Compressor still active by default (even for pure music)  
   → May slightly reduce dynamic range on very dynamic tracks  
   → If unacceptable → you can temporarily run `mgameGain(1.2)` to compensate or we can add an auto-detect / future toggle

2. No real-time compressor/limiter reduction metering exposed  
   → Could add to `mgameStatus()` using `comp.reduction.value` if desired

3. Atlas hides `chrome://webrtc-internals`  
   → Debugging bitrate/sample-rate relies on console logs or future `getStats()` additions

4. Chain rebuild requires getUserMedia restart  
   → Changing dynamics behavior mid-Space needs page reload or leave/rejoin

## Next Possible Improvements (P2 / Nice-to-have)

- P2: Add `mgameDynamics(false)` toggle (bypass compressor+limiter for pure music sessions)
- P2: Expose gain reduction in `mgameStatus()` (compressor + limiter)
- P2: Optional auto-leveling based on average loudness (very advanced)
- P3: Move soft clipper / limiter to AudioWorklet for lower latency/CPU (complex)
- P3: Add crude silence / music-vs-voice detection to auto-adjust threshold

## Quick Test Checklist (when validating new versions)

- Music-only: Play dynamic track → should not sound heavily compressed/pumped
- Voice over music: Speak loudly → voice should remain intelligible, no metallic artifacts
- Quiet → loud transitions: no obvious cuts (usedtx=0 working)
- Run `mgameGain(1.5)` mid-Space → volume changes instantly
- Check console: no repeated `setParameters` spam
- Listener side: ~128 kbps Opus, full stereo, no obvious distortion/quietness

## Console helpers (v6.5)

- `mgameGain(1.2)`        → set live output gain (0.0–3.0)
- `mgameStatus()`         → show current state (gain, PCs, AudioContext)

